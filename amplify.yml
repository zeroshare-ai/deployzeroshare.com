version: 1
backend:
  phases:
    build:
      commands:
        - |
          echo "Deploying backend resources..."
          cd amplify/backend/function/support-email
          npm install --production
          # Package Lambda function
          zip -r function.zip . -x "*.git*" "*.zip" "node_modules/.cache/*" "template.yaml" "README.md"
          # Deploy using AWS CloudFormation
          aws cloudformation package \
            --template-file template.yaml \
            --s3-bucket amplify-deployments-$(aws sts get-caller-identity --query Account --output text) \
            --output-template-file packaged-template.yaml \
            --region us-east-1 || echo "CloudFormation package failed, skipping backend deployment"
          aws cloudformation deploy \
            --template-file packaged-template.yaml \
            --stack-name deployzeroshare-support-email \
            --capabilities CAPABILITY_IAM \
            --region us-east-1 \
            --parameter-overrides \
              FromEmail=no-reply@deployzeroshare.com \
              ToEmail=rick@beaverpaw.com \
            || echo "Backend deployment skipped (may already exist or need manual setup)"
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: out
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
